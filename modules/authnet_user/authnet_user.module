<?php

/**
 * @file
 * Authorize.net - User Integration
 */

/* ******************************************************************************
 * Drupal hooks
 * *****************************************************************************/

/**
 * Implementation of hook_perm().
 */
function authnet_user_perm() {
  return array('administer authnet payment profiles');
}

/**
 * Implementation of hook_menu().
 */
function authnet_user_menu() {
  $items['user/%user/billing'] = array(
    'title' => 'Billing',
    'page callback' => 'authnet_user_billing_page',
    'page arguments' => array(1),
    'access callback' => 'authnet_user_access',
    'access arguments' => array(1),
    'type' => MENU_LOCAL_TASK,
    'file' => 'authnet_user.pages.inc',
  );
  $items['user/%user/billing/list'] = array(
    'title' => 'List',
    'type' => MENU_DEFAULT_LOCAL_TASK,
    'weight' => 1,
  );
  $items['user/%user/billing/add'] = array(
    'title' => 'Add',
    'page callback' => 'authnet_user_payment_profile',
    'page arguments' => array(1),
    'access callback' => 'authnet_user_access',
    'access arguments' => array(1),
    'type' => MENU_LOCAL_TASK,
    'file' => 'authnet_user.pages.inc',
    'weight' => 2,
  );
  return $items;
}


/* ******************************************************************************
 * Access Callbacks
 * *****************************************************************************/

/**
 * Access callback for payment profile management.
 */
function authnet_user_access($account) {
  // Allow access if logged in user matches the account, or
  // user has perm 'administer authnet payment profiles'.
  return (($GLOBALS['user']->uid == $account->uid) || user_access('administer authnet payment profiles')) && $account->uid > 0;
}